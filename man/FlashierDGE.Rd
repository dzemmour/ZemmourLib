% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/flashier_functions.R
\name{FlashierDGE}
\alias{FlashierDGE}
\title{Perform differential gene expression (DGE) analysis with flashier results.}
\usage{
FlashierDGE(F1, L1, group1, group2, title_plot = "")
}
\arguments{
\item{F1}{A gene-by-factor matrix from a flashier fit.}

\item{L1}{A cell-by-factor matrix from a flashier fit.}

\item{group1}{A character vector of cell IDs belonging to the first group.}

\item{group2}{A character vector of cell IDs belonging to the second group.}

\item{title_plot}{A character string for the title of the plots.}
}
\value{
A list containing:
\itemize{
\item \code{p1}: A ggplot object of the MA plot for factors.
\item \code{p2}: A ggplot object of the MA plot for genes.
\item \code{diff_factors}: A data frame of the differential expression results for factors.
\item \code{diff_genes}: A data frame of the differential expression results for genes.
}
}
\description{
This function calculates and visualizes differential expression for both gene programs (factors) and individual genes
between two specified groups of cells. It returns two MA plots and data tables of the results.
}
\examples{
\dontrun{
# Note: The following example assumes you have a 'fit.Rds' file
# and a 'metadata_cells.txt' file in your working directory.

# Get F1 and L1: Recommended for large datasets: Import from a flashier fit object
fit = readRDS("fit.Rds")
res = ldf(fit, type = "i")
L1 = with(res, L \%*\% diag(D) )
L1 = L1[mdata_orig$cellID,]
colnames(L1) = sprintf("F\%s", 1:ncol(L1))
F1 = with(ldf(fit, type = "i"), F)
colnames(F1) = paste("F", 1:ncol(F1), sep = "")

# We'll create some dummy data for a runnable example.
# In your actual use case, replace this with your real data loading code.
F1 <- matrix(runif(1000 * 20), nrow = 1000, ncol = 20)
L1 <- matrix(runif(500 * 20), nrow = 500, ncol = 20)
rownames(L1) <- mdata_orig$cellID[1:500]
rownames(F1) <- paste0("gene", 1:1000)
colnames(L1) <- paste0("F", 1:20)
colnames(F1) <- paste0("F", 1:20)

# Define your groups based on metadata
mdata_orig <- read.table("metadata_cells.txt", header = TRUE, sep = "\t")
# Assuming mdata_orig has columns "cellID", "annotation_level1", etc.
group1 <- mdata_orig \%>\%
  dplyr::filter(annotation_level1 \%in\% c("Treg") &
                annotation_level2 \%in\% c("Treg_cl8") &
                organ_simplified == "colon" &
                condition_broad == "healthy") \%>\%
  dplyr::pull(cellID)

group2 <- mdata_orig \%>\%
  dplyr::filter(annotation_level1 \%in\% c("Treg") &
                annotation_level2 \%in\% c("Treg_cl2") &
                organ_simplified == "colon" &
                condition_broad == "healthy") \%>\%
  dplyr::pull(cellID)

# Call the function
results <- FlashierDGE(F1, L1, group1, group2,
                       title_plot = "Treg_cl8 vs Treg_cl2 in colon healthy")

# Access and display the plots and data
results$p1    # MA plot of factors
results$p2    # MA plot of genes

results$diff_factors # table for fold changes of gene programs

# Access and sort the gene fold changes
results$diff_genes \%>\%
  dplyr::arrange(dplyr::desc(log2FC))
}
}
